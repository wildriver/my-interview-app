<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Setup (Groq)</title>
    <style>
        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body { font-family: "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: #f0f2f5; color: #333; height: 100vh; overflow: hidden; }
        .layout-container { display: grid; grid-template-columns: 350px 280px 1fr; gap: 20px; padding: 20px; height: 100vh; box-sizing: border-box; }
        .col { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow: hidden; }
        .col-header { padding: 15px 20px; border-bottom: 1px solid #eee; background: #fafafa; font-weight: bold; color: #2c3e50; flex-shrink: 0; }
        .col-content { padding: 20px; overflow-y: auto; flex-grow: 1; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9em; color: #34495e; }
        .help-text { font-size: 0.8em; color: #7f8c8d; margin-top: 2px; margin-bottom: 5px; }
        
        input[type="text"], textarea, select { width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        textarea { height: 80px; resize: vertical; }
        
        /* æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆç”¨ */
        .char-counter { float: right; font-weight: normal; font-size: 0.85em; color: #666; }
        .char-over { color: #dc3545; font-weight: bold; }

        .range-wrap { display: flex; align-items: center; gap: 10px; font-size: 0.9em; }
        input[type="range"] { flex: 1; cursor: pointer; }
        .range-val { width: 30px; text-align: right; font-weight: bold; }
        .btn { display: block; width: 100%; padding: 12px; background-color: #f55036; color: white; border: none; border-radius: 50px; font-size: 1em; font-weight: bold; cursor: pointer; transition: background 0.2s; margin-top: 20px; }
        .btn:hover { background-color: #d43f29; }
        .btn:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        .btn-preview { display: block; width: 100%; padding: 8px; background-color: #e9ecef; color: #333; border: 1px solid #ced4da; border-radius: 6px; font-size: 0.85em; cursor: pointer; text-align: center; }
        .btn-preview:hover { background-color: #dde2e6; }
        .radio-group label { display: inline-block; margin-right: 10px; font-weight: normal; cursor: pointer; font-size: 0.9em; }
        .status-indicator { font-size: 0.8em; margin-left: 5px; }
        .status-ok { color: #28a745; }
        .status-err { color: #dc3545; }
        .status-loading { color: #e67e22; }
        
        /* å±¥æ­´ãƒ»è©³ç´° */
        .history-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
        .history-item:hover { background-color: #f0f8ff; }
        .history-item.active { background-color: #fff0ee; border-left: 4px solid #f55036; }
        .history-date { font-size: 0.75em; color: #888; margin-bottom: 3px; }
        .history-title { font-weight: bold; font-size: 0.95em; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .detail-placeholder { text-align: center; color: #999; margin-top: 50px; }
        .detail-header { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .detail-title { font-size: 1.4em; font-weight: bold; color: #f55036; }
        .detail-meta { font-size: 0.85em; color: #666; margin-top: 5px; }
        .detail-section-title { font-weight: bold; margin: 20px 0 10px 0; color: #444; border-left: 4px solid #28a745; padding-left: 8px; }
        .detail-summary { background: #f9f9f9; padding: 15px; border-radius: 8px; line-height: 1.6; white-space: pre-wrap; font-size: 0.95em; }
        .detail-chat { font-size: 0.9em; }
        .chat-row { margin-bottom: 8px; padding: 8px; border-radius: 6px; }
        .chat-role { font-weight: bold; font-size: 0.8em; margin-bottom: 2px; }
        .chat-user { background-color: #e3f2fd; }
        .chat-ai { background-color: #fff0ee; }

        /* è¨­å®šæƒ…å ±è¡¨ç¤º */
        .settings-info { background: #f0f7ff; padding: 12px; border-radius: 8px; font-size: 0.9em; margin-bottom: 10px; }
        .setting-row { margin-bottom: 6px; display: flex; flex-wrap: wrap; gap: 5px; }
        .setting-label { font-weight: bold; color: #555; min-width: 70px; }
        .setting-text { background: #fff; padding: 5px 8px; border-radius: 4px; font-size: 0.85em; color: #666; margin-top: 3px; width: 100%; white-space: pre-wrap; word-break: break-word; }
        .btn-apply-settings { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9em; margin-top: 5px; }
        .btn-apply-settings:hover { background: #0056b3; }

        @media (max-width: 900px) {
            .layout-container { grid-template-columns: 1fr; height: auto; overflow: auto; }
            body { height: auto; overflow: auto; }
            .col { height: 500px; }
        }
    </style>
</head>
<body>

<div class="layout-container">
    
    <div class="col col-1">
        <div class="col-header">ğŸ›  ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼è¨­å®š (Groq)</div>
        <div class="col-content">
            <div class="form-group">
                <label>
                    Groq API Key
                    <a href="https://console.groq.com/keys" target="_blank" style="font-size: 0.85em; margin-left: 8px;">[APIã‚­ãƒ¼ã‚’å–å¾—]</a>
                    <span id="api-status" class="status-indicator"></span>
                </label>
                <input type="text" id="apiKey" placeholder="gsk_..." onblur="validateApi()">
                <label style="font-size: 0.85em; margin-top: 5px; display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" id="saveApiKey"> ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã™ã‚‹
                </label>
            </div>

            <div class="form-group">
                <label>ãƒ¢ãƒ‡ãƒ«</label>
                <select id="modelName">
                    <option value="llama-3.1-8b-instant" selected>Llama 3.1 8B Instant (æœ€é€Ÿ)</option>
                    <option value="openai/gpt-oss-20b">GPT-OSS 20B (é«˜é€Ÿ)</option>
                    <option value="meta-llama/llama-4-maverick-17b-128e-instruct">Llama 4 Maverick 17B (é«˜é€Ÿ)</option>
                    <option value="meta-llama/llama-4-scout-17b-16e-instruct">Llama 4 Scout 17B</option>
                    <option value="qwen/qwen3-32b">Qwen3 32B</option>
                    <option value="llama-3.3-70b-versatile">Llama 3.3 70B (é«˜å“è³ª)</option>
                    <option value="openai/gpt-oss-120b">GPT-OSS 120B (é«˜å“è³ª)</option>
                    <option value="moonshotai/kimi-k2-instruct-0905">Kimi K2 Instruct</option>
                </select>
            </div>

            <div class="form-group">
                <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                <input type="text" id="title" value="ç¦å²¡æœªè¸ã«é–¢ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼">
            </div>

            <div class="form-group">
                <label>
                    äº‹å‰çŸ¥è­˜ãƒ»å‚è€ƒè³‡æ–™
                    <span id="char-count" class="char-counter">0 / 3000</span>
                </label>
                <textarea id="preContext" style="height: 100px;" 
                    placeholder="ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã®å‰æã¨ãªã‚‹çŸ¥è­˜ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€è‡ªèº«ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãªã©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚" 
                    oninput="validateCharCount()"></textarea>
            </div>

            <div class="form-group">
                <label>èããŸã„ã“ã¨ãƒªã‚¹ãƒˆ</label>
                <textarea id="topics">
1. è‡ªå·±ç´¹ä»‹
2. ç¦å²¡æœªè¸ã§ã¯ã©ã‚“ãªã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã‹
3. ç¦å²¡æœªè¸ã«å¿œå‹Ÿã—ã‚ˆã†ã¨æ€ã£ãŸãã£ã‹ã‘
4. ç¦å²¡æœªè¸ã‚’çµŒé¨“ã—ã¦ã©ã†ã§ã—ãŸã‹ï¼Ÿ
5. ã‚¢ãƒ—ãƒªã®ä»Šå¾Œã¯ï¼Ÿ
6. æ¥å¹´åº¦å¿œå‹Ÿã™ã‚‹ã‚¯ãƒªã‚¨ãƒ¼ã‚¿ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</textarea>
            </div>

            <div class="form-group">
                <label>æ·±ã•</label>
                <div class="radio-group">
                    <label><input type="radio" name="depth" value="standard" checked> æ¨™æº– (3å›)</label>
                    <label><input type="radio" name="depth" value="deep"> é•·ã (5å›)</label>
                </div>
            </div>

            <div class="form-group">
                <label>éŸ³å£°</label>
                <select id="voiceName"><option value="">èª­ã¿è¾¼ã¿ä¸­...</option></select>
            </div>

            <div class="form-group">
                <label>é€Ÿåº¦ (Rate): <span id="rateVal" class="range-val">1.3</span></label>
                <div class="range-wrap">
                    <span>é…</span>
                    <input type="range" id="rate" min="0.5" max="2.0" step="0.1" value="1.3" oninput="document.getElementById('rateVal').innerText = this.value">
                    <span>é€Ÿ</span>
                </div>
                <button type="button" class="btn-preview" onclick="previewVoice()" style="margin-top:5px;">ğŸ”Š ãƒ†ã‚¹ãƒˆå†ç”Ÿ</button>
            </div>

            <div class="form-group">
                <label>AIäººæ ¼</label>
                <textarea id="persona" style="height: 60px;">Act as a master interviewer with insatiable curiosity. Ask one open-ended, engaging question at a time to dig deep into my stories and perspectives. Always build on my previous answer to keep the conversation flowing. Please must reply in Japanese.</textarea>
            </div>

            <button id="startBtn" class="btn" onclick="saveAndStart()" disabled>é–‹å§‹ã™ã‚‹</button>
            <p id="start-help" class="help-text" style="text-align:center; color:#dc3545;">â€»APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        </div>
    </div>

    <div class="col col-2">
        <div class="col-header">ğŸ—‚ å±¥æ­´ä¸€è¦§</div>
        <div class="col-content" id="history-list">
            <div style="text-align:center; color:#999; margin-top:20px;">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>

    <div class="col col-3">
        <div class="col-header">ğŸ“„ å†…å®¹è©³ç´°</div>
        <div class="col-content" id="history-detail">
            <div class="detail-placeholder">å±¥æ­´ã‚’é¸æŠã™ã‚‹ã¨<br>ã“ã“ã«è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
    </div>

</div>

<script>
    let isApiValid = false;
    let isCharValid = true;
    const MAX_CHARS = 3000;

    const DB_NAME = "InterviewDB";
    const DB_VERSION = 1;
    const STORE_NAME = "archives";

    // --- æ–‡å­—æ•°ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ---
    function validateCharCount() {
        const text = document.getElementById('preContext').value;
        const count = text.length;
        const counterEl = document.getElementById('char-count');
        
        counterEl.innerText = `${count} / ${MAX_CHARS}`;
        
        if (count > MAX_CHARS) {
            counterEl.classList.add('char-over');
            isCharValid = false;
        } else {
            counterEl.classList.remove('char-over');
            isCharValid = true;
        }
        updateStartButton();
    }

    // --- API Validation ---
    async function validateApi() {
        const key = document.getElementById('apiKey').value.trim();
        const statusEl = document.getElementById('api-status');

        if (!key) {
            statusEl.innerText = "";
            isApiValid = false;
            updateStartButton();
            return;
        }

        statusEl.className = "status-indicator status-loading";
        statusEl.innerText = "ç¢ºèªä¸­...";

        try {
            const res = await fetch("https://api.groq.com/openai/v1/models", {
                headers: { "Authorization": `Bearer ${key}` }
            });

            if (res.ok) {
                statusEl.className = "status-indicator status-ok";
                statusEl.innerText = "âœ… æœ‰åŠ¹";
                isApiValid = true;
            } else {
                statusEl.className = "status-indicator status-err";
                statusEl.innerText = "âŒ ç„¡åŠ¹";
                isApiValid = false;
            }
        } catch (e) {
            statusEl.className = "status-indicator status-err";
            statusEl.innerText = "âŒ ã‚¨ãƒ©ãƒ¼";
            isApiValid = false;
        }
        updateStartButton();
    }

    function updateStartButton() {
        const btn = document.getElementById('startBtn');
        const help = document.getElementById('start-help');
        
        // APIã‚­ãƒ¼ãŒæœ‰åŠ¹ã‹ã¤ã€æ–‡å­—æ•°åˆ¶é™å†…ã§ã‚ã‚Œã°æŠ¼ã›ã‚‹
        const ready = isApiValid && isCharValid;
        
        btn.disabled = !ready;
        
        if (!isApiValid) {
            help.innerText = "â€»æœ‰åŠ¹ãªAPIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
            help.style.display = 'block';
        } else if (!isCharValid) {
            help.innerText = "â€»äº‹å‰çŸ¥è­˜ã®æ–‡å­—æ•°ãŒä¸Šé™ã‚’è¶…ãˆã¦ã„ã¾ã™";
            help.style.display = 'block';
        } else {
            help.style.display = 'none';
        }
    }

    // --- è¨­å®šä¿å­˜ã¨é–‹å§‹ ---
    function saveAndStart() {
        const apiKey = document.getElementById('apiKey').value.trim();
        if (!apiKey) return alert("APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        // APIã‚­ãƒ¼ã®ä¿å­˜/å‰Šé™¤
        if (document.getElementById('saveApiKey').checked) {
            localStorage.setItem('groqApiKey', apiKey);
        } else {
            localStorage.removeItem('groqApiKey');
        }

        const config = {
            apiKey: apiKey,
            modelName: document.getElementById('modelName').value,
            title: document.getElementById('title').value,
            // â˜… äº‹å‰çŸ¥è­˜ã‚’ä¿å­˜
            context: document.getElementById('preContext').value,
            topics: document.getElementById('topics').value.split('\n').filter(line => line.trim() !== ''),
            depth: document.querySelector('input[name="depth"]:checked').value,
            voiceName: document.getElementById('voiceName').value, 
            rate: parseFloat(document.getElementById('rate').value),
            pitch: 1.0,
            volume: 1.0,
            persona: document.getElementById('persona').value
        };

        localStorage.setItem('interviewConfig', JSON.stringify(config));
        window.location.href = 'interview_app.html';
    }

    // --- éŸ³å£°é–¢é€£ ---
    function populateVoiceList() {
        if(typeof speechSynthesis === 'undefined') return;
        const voices = speechSynthesis.getVoices();
        const voiceSelect = document.getElementById('voiceName');
        const jaVoices = voices.filter(v => v.lang.includes('ja') || v.lang.includes('JP'));
        voiceSelect.innerHTML = '';
        if (jaVoices.length === 0) {
            const option = document.createElement('option');
            option.text = "æ—¥æœ¬èªéŸ³å£°ãªã—";
            voiceSelect.add(option); return;
        }
        jaVoices.forEach((voice) => {
            const option = document.createElement('option');
            option.textContent = `${voice.name} (${voice.lang})`;
            option.value = voice.name;
            if(voice.name === 'Google æ—¥æœ¬èª') option.selected = true;
            voiceSelect.appendChild(option);
        });
    }
    populateVoiceList();
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
    }

    // ä¿å­˜ã•ã‚ŒãŸAPIã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã‚€
    (function loadSavedApiKey() {
        const savedKey = localStorage.getItem('groqApiKey');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
            document.getElementById('saveApiKey').checked = true;
            validateApi();
        }
    })();

    function previewVoice() {
        const voiceName = document.getElementById('voiceName').value;
        const rate = parseFloat(document.getElementById('rate').value);
        if (!voiceName) return alert("éŸ³å£°ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“");
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance("ä»Šæ—¥ã¯ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼");
        utterance.rate = rate; utterance.volume = 1.0; utterance.pitch = 1.0;
        const voices = window.speechSynthesis.getVoices();
        const selectedVoice = voices.find(v => v.name === voiceName);
        if (selectedVoice) utterance.voice = selectedVoice;
        window.speechSynthesis.speak(utterance);
    }

    // --- DB & å±¥æ­´è¡¨ç¤º ---
    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            request.onupgradeneeded = (e) => { 
                const db = e.target.result; 
                if (!db.objectStoreNames.contains(STORE_NAME)) db.createObjectStore(STORE_NAME, { keyPath: "id" });
            };
            request.onsuccess = (e) => resolve(e.target.result);
            request.onerror = (e) => reject(e.target.error);
        });
    }

    async function loadHistory() {
        const listEl = document.getElementById('history-list');
        try {
            const db = await openDB();
            const tx = db.transaction(STORE_NAME, "readonly");
            const store = tx.objectStore(STORE_NAME);
            const request = store.getAll();

            request.onsuccess = () => {
                const records = request.result;
                records.sort((a, b) => b.id - a.id);

                if (records.length === 0) {
                    listEl.innerHTML = "<div style='text-align:center; color:#999; margin-top:20px;'>å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>";
                    return;
                }

                listEl.innerHTML = "";
                records.forEach(rec => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `<div class="history-date">${rec.date}</div><div class="history-title">${rec.title}</div>`;
                    item.onclick = () => {
                        document.querySelectorAll('.history-item').forEach(el => el.classList.remove('active'));
                        item.classList.add('active');
                        showDetail(rec);
                    };
                    listEl.appendChild(item);
                });
            };
        } catch (e) {
            console.error(e);
            listEl.innerHTML = "DBã‚¨ãƒ©ãƒ¼";
        }
    }

    // ç¾åœ¨é¸æŠä¸­ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¿æŒ
    let selectedRecord = null;

    function showDetail(rec) {
        selectedRecord = rec;
        const detailEl = document.getElementById('history-detail');
        const chatHtml = rec.history.map(h => {
            const role = h.role === 'assistant' ? 'ğŸ¤– AI' : (h.role === 'user' ? 'ğŸ‘¤ User' : h.role);
            const roleClass = h.role === 'assistant' ? 'chat-ai' : 'chat-user';
            const text = h.content;
            return `<div class="chat-row ${roleClass}"><div class="chat-role">${role}</div><div>${text}</div></div>`;
        }).join('');

        // è¨­å®šæƒ…å ±ã®HTMLï¼ˆè¨­å®šãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰
        let settingsHtml = '';
        if (rec.settings) {
            const s = rec.settings;
            settingsHtml = `
                <div class="detail-section-title">ä½¿ç”¨è¨­å®š</div>
                <div class="settings-info">
                    <div class="setting-row"><span class="setting-label">ãƒ¢ãƒ‡ãƒ«:</span> ${s.modelName || 'ä¸æ˜'}</div>
                    <div class="setting-row"><span class="setting-label">æ·±ã•:</span> ${s.depth === 'deep' ? 'é•·ã (5å›)' : 'æ¨™æº– (3å›)'}</div>
                    <div class="setting-row"><span class="setting-label">éŸ³å£°:</span> ${s.voiceName || 'ä¸æ˜'}</div>
                    <div class="setting-row"><span class="setting-label">é€Ÿåº¦:</span> ${s.rate || 'ä¸æ˜'}</div>
                    ${s.context ? `<div class="setting-row"><span class="setting-label">äº‹å‰çŸ¥è­˜:</span><div class="setting-text">${s.context.substring(0, 200)}${s.context.length > 200 ? '...' : ''}</div></div>` : ''}
                    ${s.persona ? `<div class="setting-row"><span class="setting-label">AIäººæ ¼:</span><div class="setting-text">${s.persona.substring(0, 200)}${s.persona.length > 200 ? '...' : ''}</div></div>` : ''}
                </div>
                <button onclick="applySettings()" class="btn-apply-settings">ğŸ”„ ã“ã®è¨­å®šã‚’ã‚»ãƒƒãƒˆ</button>
            `;
        }

        detailEl.innerHTML = `
            <div class="detail-header">
                <div class="detail-title">${rec.title}</div>
                <div class="detail-meta">æ—¥æ™‚: ${rec.date}</div>
            </div>
            ${settingsHtml}
            <div class="detail-section-title">ã‚µãƒãƒªãƒ¼</div>
            <div class="detail-summary">${rec.summary}</div>
            <button onclick="navigator.clipboard.writeText(\`${rec.summary.replace(/`/g, '\\`')}\`)" style="margin-top:5px; padding:5px; font-size:0.8em; cursor:pointer;">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            <div class="detail-section-title">ä¼šè©±ãƒ­ã‚° (${rec.history.length}ã‚¿ãƒ¼ãƒ³)</div>
            <div class="detail-chat">${chatHtml}</div>
        `;
    }

    function applySettings() {
        if (!selectedRecord || !selectedRecord.settings) {
            alert('ã“ã®å±¥æ­´ã«ã¯è¨­å®šæƒ…å ±ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            return;
        }
        const s = selectedRecord.settings;
        const rec = selectedRecord;

        // ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®šã‚’åæ˜ 
        document.getElementById('title').value = rec.title || '';
        document.getElementById('preContext').value = s.context || '';
        document.getElementById('topics').value = rec.topics ? rec.topics.join('\n') : '';
        document.getElementById('persona').value = s.persona || '';

        // ãƒ¢ãƒ‡ãƒ«é¸æŠ
        const modelSelect = document.getElementById('modelName');
        if (s.modelName) {
            for (let opt of modelSelect.options) {
                if (opt.value === s.modelName) {
                    opt.selected = true;
                    break;
                }
            }
        }

        // æ·±ã•
        if (s.depth) {
            const depthRadio = document.querySelector(`input[name="depth"][value="${s.depth}"]`);
            if (depthRadio) depthRadio.checked = true;
        }

        // éŸ³å£°ï¼ˆãƒªã‚¹ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
        const voiceSelect = document.getElementById('voiceName');
        if (s.voiceName) {
            for (let opt of voiceSelect.options) {
                if (opt.value === s.voiceName) {
                    opt.selected = true;
                    break;
                }
            }
        }

        // é€Ÿåº¦
        if (s.rate) {
            document.getElementById('rate').value = s.rate;
            document.getElementById('rateVal').innerText = s.rate;
        }

        // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
        validateCharCount();

        alert('è¨­å®šã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼å·¦ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }

    loadHistory();
</script>

</body>
</html>